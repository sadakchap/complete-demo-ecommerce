{% extends "base.html" %}
{% load static %}
{% block extrastyles %}
	<link rel="stylesheet" href="https://unpkg.com/swiper/css/swiper.min.css">
{% endblock %}
{% block content %}

<!-- category slider start -->
<div class="container-fluid">
	<div class="heading-text">
		<h3>Shop by Category</h3>
		<p class="sub-title">Browse in all our categories</p>
	</div>
	<div class="swiper-container">
		<div class="swiper-wrapper">
			{% for cat in con_categories %}
				<div class="swiper-slide">
					<a href="{{ cat.get_absolute_url }}" class="cat-link">
					<div class="category-box">
						<div class="cat-image"><img src="{% if cat.image %}{{ cat.image.url }}{% else %}media/products/2020/03/06/watch1.jpg{% endif %}" alt=""></div>
						<div class="cat-detail">
							<div class="cat-name">{{ cat.name }}</div>
							<div class="cat-products">{{ cat.products.count }} products</div>
						</div>
					</div>
					</a>
				</div>
			{% endfor %}
		</div>
		<div class="swiper-pagination"></div>
	</div>
</div>
<!-- category slider start -->

<!-- sale products start -->
<div class="container-fluid">
	<div class="heading-text">
		<h3>Products on sale</h3>
		<p class="sub-title">Check all our products on sale</p>
	</div>
	<div class="row">
		{% for product in products_on_sale %}
		<div class="col-6 col-md-4 col-lg-3">
			<div class="product-default product">
				<div class="product-image">
					<a href="{{ product.get_absolute_url }}" class="product-image-anchor">
						<img src="{{ product.image.url }}" alt="">
					</a>
					{% if product.discount_percent %}
					<div class="discount-label">{{ product.discount_percent }}% Off</div>
					{% endif %}
					<div class="add-to-cart-btn-icon">
						<a href="add-to-cart/" class="add-to-cart-btn-icon-anchor" data-product-id="{{ product.id }}">
							<i class="fa fa-shopping-bag" aria-hidden="true"></i>
						</a>
					</div>
					<div class="quick-view-btn"><a href="" class="quick-view-btn-anchor" data-product-id="{{ product.id }}">Quick view</a></div>
				</div>
				<div class="product-detail">
					<div class="product-category">
						<a href="{{ product.category.get_absolute_url }}" class="product-category-anchor">{{ product.category }}</a>
					</div>
					<div class="product-title">
						<a href="{{ product.get_absolute_url }}" class="product-title-anchor">{{ product.name|truncatewords:4 }}</a>
					</div>
					<div class="ratings-container">
						<span class="fa fa-star checked"></span>
						<span class="fa fa-star checked"></span>
						<span class="fa fa-star checked"></span>
						<span class="fa fa-star checked"></span>
						<span class="fa fa-star"></span>
					</div>
					<div class="product-price">
						<span class="old-price">${{ product.price }}</span>
						<span class="discount-price">${{ product.get_price }}</span>
					</div>
				</div>
			</div>
		</div>
		{% endfor %}
	</div>
</div>
<!-- sale products end -->

<!-- featured products start -->
<div class="container-fluid bg-light pt-2">
	<div class="heading-text">
		<h3>Featured Products</h3>
		<p class="sub-title">Check all our featured products</p>
	</div>
	<div class="row">
		{% for product in featured_products %}
		<div class="col-6 col-md-4 col-lg-3">
			<div class="product-default product">
				<div class="product-image">
					<a href="{{ product.get_absolute_url }}" class="product-image-anchor">
						<img src="{{ product.image.url }}" alt="">
					</a>
					{% if product.discount_percent %}
					<div class="discount-label">{{ product.discount_percent }}% Off</div>
					{% endif %}
					<div class="add-to-cart-btn-icon">
						<a href="add-to-cart/" class="add-to-cart-btn-icon-anchor" data-product-id="{{ product.id }}">
							<i class="fa fa-shopping-bag" aria-hidden="true"></i>
						</a>
					</div>
					<div class="quick-view-btn"><a href="" class="quick-view-btn-anchor" data-product-id="{{ product.id }}">Quick view</a></div>
				</div>
				<div class="product-detail">
					<div class="product-category">
						<a href="{{ product.category.get_absolute_url }}"
							class="product-category-anchor">{{ product.category }}</a>
					</div>
					<div class="product-title">
						<a href="{{ product.get_absolute_url }}"
							class="product-title-anchor">{{ product.name|truncatewords:4 }}</a>
					</div>
					<div class="ratings-container">
						<span class="fa fa-star checked"></span>
						<span class="fa fa-star checked"></span>
						<span class="fa fa-star checked"></span>
						<span class="fa fa-star checked"></span>
						<span class="fa fa-star"></span>
					</div>
					<div class="product-price">
						<span class="old-price">${{ product.price }}</span>
						<span class="discount-price">${{ product.get_price }}</span>
					</div>
				</div>
			</div>
		</div>
		{% endfor %}
	</div>
</div>
<!-- featured products end -->


{% endblock %}
{% block extra_scripts %}
	<script src="https://unpkg.com/swiper/js/swiper.min.js"></script>
	<script>
		var swiper = new Swiper('.swiper-container', {
			slidesPerView: 'auto',
			spaceBetween: 15,
			pagination: {
				el: '.swiper-pagination',
				clickable: true,
			},
			autoplay: {
				delay: 2500,
				disableOnInteraction: false,
			},
		});
	</script>
	<script>
		$(document).ready(function(){
			$('.add-to-cart-btn-icon-anchor').on("click", function(e){
				e.preventDefault();
				var product_id = $(this).data("product-id")

				$.post({
					url: "{% url 'cart:cart_add_ajax' %}",
					data: {
						product_id: product_id,
					},
					dataType: 'json',
					success: function (data) {
						if (data.added == 'ok') {
							$('#nav-cart-length').text(data.cart_length);
							$('#nav-cart-total').text('$' + data.cart_total);
							$("#nav-cart-total-items").text(data.cart_length + " items");

							added_item = data.added_item;
							var itemDiv = $("#nav-cart-list").find("#cart-item-" + data.added_item.cart_item_product_id);
							if (itemDiv.length) {
								var detailDiv = itemDiv.children().first()
								detailDiv.find('span').text(data.added_item.quantity + ' x $' + data.added_item.price);
							} else {
								// adding new list divElement
								itemDiv = $('#new-nav-cart-item').html();
								$("#nav-cart-list").children().last().prev().before(itemDiv);

								var addedElementDiv = $("#nav-cart-list").children().eq(-3).children();

								addedElementDiv.css('display', 'flex');
								addedElementDiv.attr("id", "cart-item-" + added_item.cart_item_product_id);

								var detailDiv = addedElementDiv.children().first();
								detailDiv.find('.product-name').attr("href", added_item.product_url);
								detailDiv.find('.product-name').text(added_item.product_name); // added truncated string
								detailDiv.find('span').text(added_item.quantity + ' x $' + added_item.price);

								var imageDiv = addedElementDiv.children().last();
								imageDiv.find('img').attr("src", added_item.product_image_url);
								imageDiv.find(".nav-cart-item-remove").data("product-id", added_item.cart_item_product_id);
							}
							alert('Item Added to cart!!!');
						} else {
							alert(data.error_message);
						}

					}
				});
			});
		});
	</script>
{% endblock %}